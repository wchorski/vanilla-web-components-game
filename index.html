<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Chao Pet</title>
		<link rel="stylesheet" href="style.css" />
		<link rel="stylesheet" href="./css/character.css" />
		<script src="script.js" type="module" defer></script>
		<script src="components/number-counter.js" type="module" defer></script>
		<script src="components/character-sprite.js" type="module" defer></script>
		<script src="components/health-meter.js" type="module" defer></script>
		<script src="components/fruit-item.js" type="module" defer></script>
		<script src="components/drop-zone.js" type="module" defer></script>
		<script src="components/shop-item.js" type="module" defer></script>
		<script src="components/gptdrop-zone.js" type="module" defer></script>
	</head>
	<body>
		<div class="playfield disable-drag" id="playfield">
			<img
				class="playfield-img"
				src="sprites/garden.png"
				alt="playfield background garden"
			/>
			<character-sprite
				id="character"
				class="character char_translate"
				alt="Character"
				src="./sprites/chao-neutral-v5.png"
				state="eat"
			></character-sprite>

			<!-- <fruit-item type="round" x="0" y="0" hungerValue="0.2"></fruit-item> -->
			<fruit-item type="tri" x="40" y="50" hungerValue="0.5"></fruit-item>
			<fruit-item type="curved" x="20" y="100" hungerValue="0.9"></fruit-item>

			<!-- <drop-zone class="basket"></drop-zone> -->

			<div id="shop">
				<h2>Shop</h2>
				<ul>
					<li>
						<shop-item type="round" cost="30" hungerValue="0.3"></shop-item>
					</li>
					<li>
						<shop-item type="curved" cost="61" hungerValue="0.7"></shop-item>
					</li>
					<li>
						<shop-item type="tri" cost="45" hungerValue="0.5"></shop-item>
					</li>
				</ul>
			</div>
		</div>

		<!-- <button onclick="moveCharacter()">Move Character</button> -->

		<!-- <a href="https://www.youtube.com/watch?v=4ZCJDf5gjLA">
			Go Make Things tutorial
		</a>
		<br />
		<br /> -->
		<div class="flex ui_wrap">
			<number-counter class="number-counter">
				<button class="add" title="add" aria-label="add" id="addToPoints">
					+
				</button>
				<!-- <button class="subtract" title="subtract" aria-label="subtract">
					-
				</button> -->
				<img src="sprites/ring.png" alt="points icon" class="ring-icon" />
				<span class="points-number" id="pointsDisplay"> 0 </span>
			</number-counter>

			<!-- <button aria-label="feed fruit" title="feed fruit" id="setHunger">
				<div class="fruits_wrap">
					<img
						class="fruits"
						src="./sprites/fruits.png"
						alt="fruits icon"
						width="60px"
					/>
				</div>
			</button> -->

			<div class="meters_wrap">
				<health-meter
					value="1.0"
					min="0"
					max="1.0"
					label="hunger"
					id="hungerMeter"
					hue="17"
				></health-meter>

				<health-meter
					value="0.4"
					min="0"
					max="1.0"
					label="sleep"
					id="sleepMeter"
					hue="172"
				></health-meter>

				<health-meter
					value="0.6"
					min="0"
					max="1.0"
					label="energy"
					id="energyMeter"
					hue="272"
				></health-meter>

				<health-meter
					value="0.5"
					min="0"
					max="1.0"
					label="happyness"
					id="happynessMeter"
					hue="72"
				></health-meter>
			</div>
		</div>

		<!-- TEST STUFF -->
		<form id="loginForm">
			<input id="username" placeholder="name" />
			<input id="password" placeholder="password" type="password" />
			<button type="submit">LOGIN!</button>
			<p id="output"></p>

			<a href="https://chao-db.tawtaw.site/_utils">Go to Project Fauxton</a>
		</form>

		<button id="testDB">test Get Characters</button>
		<p id="testDB_output">press button...</p>

		<script>
			const form = document.getElementById("loginForm")

			form.addEventListener("submit", (e) => {
				e.preventDefault()
				const data = { name: username.value, password: password.value }
				output.innerText = ""
				fetch("https://chao-db.tawtaw.site/_session", {
					method: "POST",
					credentials: "include",
					headers: {
						"content-type": "application/json",
						authorization: `Basic ${btoa(data.name + ":" + data.password)}`,
					},
					body: JSON.stringify(data),
				})
					.then((res) => res.text())
					.then((res) => (output.innerText = res))
			})
			// -----

			const testDB_Btn = document.getElementById("testDB")

			testDB_Btn.addEventListener("click", () => {
				console.log("db fetch characters")
				fetchCharacters()
			})

			const db_output = document.getElementById("testDB_output")

			async function fetchCharacters() {
				try {
					const response = await fetch(
						// "https://chao-db.tawtaw.site/_users/_all_docs?include_docs=true",
						"https://chao-db.tawtaw.site/characters/_all_docs?include_docs=true",
						{
							method: "GET",
							credentials: "include",
							headers: {
								Authorization:
									"Basic " + btoa("chao-admin:46Y5RStSZ78pCyZDApq&kKnQ!tj9Gj"), // Replace with your CouchDB username and password
								"Content-Type": "application/json",
							},
						}
					)

					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`)
					}

					const data = await response.json()
					const characters = data.rows.map((row) => row.doc) // Extract user documents
					console.log(characters)
					db_output.innerText = JSON.stringify(characters, null, 2)

					return characters
				} catch (error) {
					console.error("Error fetching characters:", error)
				}
			}
		</script>
	</body>
</html>
